#!/usr/bin/env php
<?php

if (PHP_SAPI !== 'cli') {
    echo 'Warning: adminer-cli should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;
}

error_reporting(-1);

$options = getopt("hp:H:v:t:");
$argv = $_SERVER['argv'];
if (isset($options['h'])) {
    echo <<<EOF
Usage: adminer [-p port] [-H host] [-v adminer_version] [-t theme]

Command line interface to run adminer on the PHP built-in server

Options:
  -p    Listen port
  -H    Listen host
  -t    Specify the theme (flat|nette|lucas-sandery|...).
  -v    Specify the adminer version.


EOF;
    exit(0);
}

$port = "8080";
if (isset($options['p'])) {
    $port = $options['p'];
}

$host = "0.0.0.0";
if (isset($options['H'])) {
    $host = $options['H'];
}

$theme = null;
if (isset($options['t'])) {
    $theme = $options['t'];
}

$version = "4.3.1";
if (isset($options['v'])) {
    $version = $options['v'];
}

$rootDir = dirname(__DIR__);
$docRoot = $rootDir;
$adminerPath = "$rootDir/src/adminer/$version/adminer-$version.php";
$routerScript = "$rootDir/src/router.php";

if (!file_exists($adminerPath)) {
    echo "unsupported version: $version\n";
    exit(1);
}
putenv("ADMINER_PATH=".$adminerPath);

if ($theme) {
    $themePath = "$rootDir/src/designs/$theme/adminer.css";
    if (!file_exists($themePath)) {
        echo "unsupported theme: $theme\n";
        exit(1);
    }

    $docRoot = dirname($themePath);
    putenv("ADMINER_THEME_PATH=".$themePath);
}

echo "Adminer runs on http://{$host}:{$port}\n";

chdir($docRoot);
passthru(PHP_BINARY." -d variables_order=EGPCS -S {$host}:{$port} {$routerScript}");
